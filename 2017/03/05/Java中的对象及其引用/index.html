<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="format-detection" content="email=no"><meta name="description" content="啊，你在看我博客"><meta name="keywords" content="Hexo, Gruntjs, Nodejs, Reactjs, Vuejs"><title>Java中的对象及其引用 - Blog</title><link rel="stylesheet" href="/css/main_style.min.css"><link rel="icon" href="/code_fork.ico"></head><body><div class="post-header"><img class="background" src="/default_images/post_background.jpg"><div class="post-title"><h1 class="title">Java中的对象及其引用</h1><ul class="meta"><li><i class="icon icon-author"></i>Walden Lu</li><li><i class="icon icon-clock"></i>18 Minutes</li><li><i class="icon icon-calendar"></i>March 5, 2017</li></ul></div></div><div class="article-content" style="max-width:600px"><h3 id="对象-amp-amp-引用"><a href="#对象-amp-amp-引用" class="headerlink" title="对象&amp;&amp;引用"></a>对象&amp;&amp;引用</h3><p>talk is cheep,直接看代码吧。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"> <span class="class"><span class="keyword">class</span> <span class="title">Vehicle</span> </span>&#123; </div><div class="line">       <span class="keyword">int</span> passengers;      </div><div class="line"></div><div class="line">       <span class="keyword">int</span> fuelcap; </div><div class="line"></div><div class="line">       <span class="keyword">int</span> mpg; </div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这是一个类的模板，通过这个模板声明对象：<br><code>Vehicle veh1 = new Vehicle();</code> </p>
<p>这一条语句其实含了四个动作。 </p>
<ol>
<li><p>右边的“new Vehicle”，是以Vehicle类为模板，在堆空间里创建一个Vehicle类对象（也简称为Vehicle对象）。 </p>
</li>
<li><p>末尾的()意味着，在对象创建后，立即调用Vehicle类的构造函数，对刚生成的对象进行初始化。构造函数是肯定有的。如果你没写，Java会给你补上一个默认的构造函数。 </p>
</li>
<li><p>左边的“Vehicle veh 1”创建了一个Vehicle类引用变量。所谓Vehicle类引用，就是以后可以用来指向Vehicle对象的对象引用。 </p>
</li>
<li><p>“=”操作符使对象引用指向刚创建的那个Vehicle对象。 </p>
</li>
</ol>
<p>我们可以把这条语句拆成两部分：<br>Vehicle veh1;  //声明一个引用</p>
<p>veh1 = new Vehicle(); //实例化一个对象，并让引用指向这个对象  </p>
<p>在堆空间里创建的实体，与在数据段以及栈空间里创建的实体不同。尽管它们也是确确实实存在的实体，但是，我们看不见，也摸不着。不仅如此，<br>我们仔细研究一下第二句，找找刚创建的对象叫什么名字？有人说，它叫“Vehicle”。不对，“Vehicle”是类（对象的创建模板）的名字。<br> 一个Vehicle类可以据此创建出无数个对象，这些对象不可能全叫“Vehicle”。 </p>
<p>对象连名都没有，没法直接访问它。我们只能通过对象引用来间接访问对象。 </p>
<p>为了形象地说明对象、引用及它们之间的关系，可以做一个或许不很妥当的比喻。对象好比是一只很大的气球，大到我们抓不住它。引用变量是一根绳， 可以用来系汽球。 </p>
<p>如果只执行了第一条语句，还没执行第二条，此时创建的引用变量veh1还没指向任何一个对象，它的值是null。引用变量可以指向某个对象，或者为null。 </p>
<p>它是一根绳，一根还没有系上任何一个汽球的绳。执行了第二句后，一只新汽球做出来了，并被系在veh1这根绳上。我们抓住这根绳，就等于抓住了那只汽球。 </p>
<p>再来一句： </p>
<p>Vehicle veh2; </p>
<p>就又做了一根绳，还没系上汽球。如果再加一句： </p>
<p>veh2 = veh1; </p>
<p>系上了。这里，发生了复制行为。但是，要说明的是，对象本身并没有被复制，被复制的只是对象引用。结果是，veh2也指向了veh1所指向的对象。两根绳系的是同一只汽球。 </p>
<p>如果用下句再创建一个对象： </p>
<p>veh2 = new Vehicle(); </p>
<p>则引用变量veh2改指向第二个对象。 </p>
<p>从以上叙述再推演下去，我们可以获得以下结论： </p>
<ol>
<li><p>一个对象引用可以指向0个或1个对象（一根绳子可以不系汽球，也可以系一个汽球）； </p>
</li>
<li><p>一个对象可以有N个引用指向它（可以有N条绳子系住一个汽球）。 </p>
</li>
</ol>
<p>如果再来下面语句： </p>
<p>veh1 = veh2; </p>
<p>按上面的推断，veh1也指向了第二个对象。这个没问题。问题是第一个对象呢？没有一条绳子系住它，它飞了。多数书里说，它被Java的垃圾回收机制回收了。 </p>
<p>这不确切。正确地说，它已成为垃圾回收机制的处理对象。至于什么时候真正被回收，那要看垃圾回收机制的心情了。 </p>
<p>由此看来，下面的语句应该不合法吧？至少是没用的吧？ </p>
<p>new Vehicle(); </p>
<p>不对。它是合法的，而且可用的。譬如，如果我们仅仅为了打印而生成一个对象，就不需要用引用变量来系住它。最常见的就是打印字符串： </p>
<p>System.out.println(“I am Java!”); </p>
<p>字符串对象“I am Java!”在打印后即被丢弃。有人把这种对象称之为临时对象。 </p>
<p>对象与引用的关系将持续到对象回收。 </p>
<hr>
<h3 id="参数传递"><a href="#参数传递" class="headerlink" title="参数传递"></a>参数传递</h3><p>StringBuffer s; </p>
<p>s = new StringBuffer(“Hello World!”); </p>
<p>第一个语句仅为引用(reference)分配了空间，而第二个语句则通过调用类(StringBuffer)的构造函数StringBuffer(String str)为类生成了一个实例（或称为对象）。这两个操作被完成后，对象的内容则可通过s进行访问——在Java里都是通过引用来操纵对象的。 </p>
<p>Java对象和引用的关系可以说是互相关联，却又彼此独立。彼此独立主要表现在：引用是可以改变的，它可以指向别的对象，譬如上面的s，你可以给它另外的对象，如： </p>
<p>s = new StringBuffer(“Java”); </p>
<p>这样一来，s就和它指向的第一个对象脱离关系。 </p>
<p>从存储空间上来说，对象和引用也是独立的，它们存储在不同的地方，对象一般存储在堆中，而引用存储在速度更快的堆栈中。 </p>
<p>引用可以指向不同的对象，对象也可以被多个引用操纵，如： </p>
<p>StringBuffer s1 = s; </p>
<p>这条语句使得s1和s指向同一个对象。既然两个引用指向同一个对象，那么不管使用哪个引用操纵对象，对象的内容都发生改变，并且只有一份，通过s1和s得到的内容自然也一样，(String除外，因为String始终不变，String s1=”AAAA”; String s=s1,操作s,s1由于始终不变，所以为s另外开辟了空间来存储s,)如下面的程序：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">StringBuffer s;  </div><div class="line">  </div><div class="line">s = <span class="keyword">new</span> StringBuffer(<span class="string">"Java"</span>);  </div><div class="line">  </div><div class="line">StringBuffer s1 = s;  </div><div class="line">  </div><div class="line">s1.append(<span class="string">" World"</span>);  </div><div class="line">  </div><div class="line">System.out.println(<span class="string">"s1="</span> + s1.toString());<span class="comment">//打印结果为：s1=Java World  </span></div><div class="line">  </div><div class="line">System.out.println(<span class="string">"s="</span> + s.toString());<span class="comment">//打印结果为：s=Java World</span></div></pre></td></tr></table></figure>
<p>上面的程序表明，s1和s打印出来的内容是一样的，这样的结果看起来让人非常疑惑，但是仔细想想，s1和s只是两个引用，它们只是操纵杆而已，它们指向同一个对象，操纵的也是同一个对象，通过它们得到的是同一个对象的内容。</p>
<p><strong>只有理解了对象和引用的关系，才能理解参数传递。</strong> </p>
<p>一般面试题中都会考Java传参的问题，并且它的标准答案是Java只有一种参数传递方式：那就是按值传递，即Java中传递任何东西都是传值。如果传入方法的是基本类型的东西，你就得到此基本类型的一份拷贝。如果是传递引用，就得到引用的拷贝。 </p>
<p>一般来说，对于基本类型的传递，我们很容易理解，而对于对象，总让人感觉是按引用传递，看下面的程序： </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ObjectRef</span> </span>&#123;  </div><div class="line">  </div><div class="line">   </div><div class="line">  </div><div class="line">    <span class="comment">//基本类型的参数传递  </span></div><div class="line">  </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testBasicType</span><span class="params">(<span class="keyword">int</span> m)</span> </span>&#123;  </div><div class="line">  </div><div class="line">        System.out.println(<span class="string">"m="</span> + m);<span class="comment">//m=50  </span></div><div class="line">  </div><div class="line">        m = <span class="number">100</span>;  </div><div class="line">  </div><div class="line">        System.out.println(<span class="string">"m="</span> + m);<span class="comment">//m=100  </span></div><div class="line">  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">     </div><div class="line">  </div><div class="line">    <span class="comment">//参数为对象，不改变引用的值 ？？？？？？  </span></div><div class="line">  </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(StringBuffer s)</span> </span>&#123;  </div><div class="line">  </div><div class="line">        s.append(<span class="string">"_add"</span>);  </div><div class="line">  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">     </div><div class="line">  </div><div class="line">    <span class="comment">//参数为对象，改变引用的值 ？？？？？  </span></div><div class="line">  </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">changeRef</span><span class="params">(StringBuffer s)</span> </span>&#123;  </div><div class="line">  </div><div class="line">        s = <span class="keyword">new</span> StringBuffer(<span class="string">"Java"</span>);  </div><div class="line">  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">     </div><div class="line">  </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;  </div><div class="line">  </div><div class="line">        <span class="keyword">int</span> i = <span class="number">50</span>;  </div><div class="line">  </div><div class="line">        testBasicType(i);  </div><div class="line">  </div><div class="line">        System.out.println(i);<span class="comment">//i=50  </span></div><div class="line">  </div><div class="line">        StringBuffer sMain = <span class="keyword">new</span> StringBuffer(<span class="string">"init"</span>);  </div><div class="line">  </div><div class="line">        System.out.println(<span class="string">"sMain="</span> + sMain.toString());<span class="comment">//sMain=init  </span></div><div class="line">  </div><div class="line">        add(sMain);  </div><div class="line">  </div><div class="line">        System.out.println(<span class="string">"sMain="</span> + sMain.toString());<span class="comment">//sMain=init_add  </span></div><div class="line">  </div><div class="line">        changeRef(sMain);  </div><div class="line">  </div><div class="line">        System.out.println(<span class="string">"sMain="</span> + sMain.toString());<span class="comment">//sMain=init_add  </span></div><div class="line">  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>以上程序的运行结果显示出，testBasicType方法的参数是基本类型，尽管参数m的值发生改变，但并不影响i。 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testBasicType</span><span class="params">(<span class="keyword">int</span> m)</span> </span>&#123;  </div><div class="line">        m = i;<span class="comment">//为了便于理解，可以加上这一句</span></div><div class="line">  </div><div class="line">        System.out.println(<span class="string">"m="</span> + m);<span class="comment">//m=50  </span></div><div class="line">  </div><div class="line">        m = <span class="number">100</span>;  </div><div class="line">  </div><div class="line">        System.out.println(<span class="string">"m="</span> + m);<span class="comment">//m=100  </span></div><div class="line">  </div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>add方法的参数是一个对象，当把sMain传给参数s时，s得到的是sMain的拷贝，所以s和sMain指向同一个对象，因此，使用s操作影响的其实就是sMain指向的对象，故调用add方法后，sMain指向的对象的内容发生了改变。 其实这样的传递参数完全可以看作在原程序上加上了一句</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(StringBuffer s)</span> </span>&#123;  </div><div class="line"></div><div class="line">      s = t;<span class="comment">//为了方便理解，加上这一句</span></div><div class="line">      s.append(<span class="string">"_add"</span>);  </div><div class="line"></div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>在changeRef方法中，参数也是对象，当把sMain传给参数s时，s得到的是sMain的拷贝，但与add方法不同的是，在方法体内改变了s指向的对象（也就是s指向了别的对象,牵着气球的绳子换气球了），给s重新赋值后，s与sMain已经毫无关联，它和sMain指向了不同的对象，所以不管对s做什么操作，都不会影响sMain指向的对象，故调用changeRef方法前后sMain指向的对象内容并未发生改变。 changeRef中也一样加上赋值语句，这里就不再写了。<br><img src="http://olxo556gm.bkt.clouddn.com/1.png?imageView2/0/q/75|watermark/2/text/c3NzY29yY2g=/font/5a6L5L2T/fontsize/240/fill/IzAwMDAwMA==/dissolve/54/gravity/SouthEast/dx/10/dy/10|imageslim" alt=""></p>
<p>对于add方法的调用结果，可能很多人会有这种感觉：这不明明是按引用传递吗？对于这种问题，还是套用Bruce Eckel的话：这依赖于你如何看待引用，最终你会明白，这个争论并没那么重要。真正重要的是，你要理解，传引用使得（调用者的）对象的修改变得不可预期。 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">public</span>   <span class="class"><span class="keyword">class</span>   <span class="title">Test</span>  </span></div><div class="line">&#123;   <span class="keyword">public</span> <span class="keyword">int</span>   i,j;    </div><div class="line">    <span class="function"><span class="keyword">public</span>   <span class="keyword">void</span>   <span class="title">test_m</span><span class="params">(Test   a)</span>  </span></div><div class="line">    &#123;     Test   b   =  <span class="keyword">new</span>   Test();  </div><div class="line">          b.i   =   <span class="number">1</span>;  </div><div class="line">          b.j   =   <span class="number">2</span>;  </div><div class="line">          a   =   b;  </div><div class="line">    &#125;  </div><div class="line">    <span class="function"><span class="keyword">public</span>   <span class="keyword">void</span>   <span class="title">test_m1</span><span class="params">(Test   a   )</span>  </span></div><div class="line">    &#123;     a.i   =   <span class="number">1</span>;  </div><div class="line">        a.j   =   <span class="number">2</span>;  </div><div class="line">    &#125;  </div><div class="line">    <span class="function"><span class="keyword">public</span>   <span class="keyword">static</span>   <span class="keyword">void</span>   <span class="title">main</span><span class="params">(String   argv[])</span>  </span></div><div class="line">    &#123;     Test   t=   <span class="keyword">new</span>   Test();  </div><div class="line">          t.i   =   <span class="number">5</span>;  </div><div class="line">          t.j   =   <span class="number">6</span>;  </div><div class="line">          System.out.println( <span class="string">"t.i   =   "</span>+   t.i   +   <span class="string">"   t.j=   "</span>   +   t.j); <span class="comment">//5,6  </span></div><div class="line">          t.test_m(t);  </div><div class="line">          System.out.println( <span class="string">"t.i   =   "</span>+   t.i   +   <span class="string">"   t.j=   "</span>   +   t.j); <span class="comment">//5,6,a和t都指向了一个对象，而在test_m中s又指向了另一个对象，所以对象t不变！！！  </span></div><div class="line">  </div><div class="line">          t.test_m1(t);  </div><div class="line">  </div><div class="line">          System.out.println( <span class="string">"t.i   =   "</span>+   t.i   +   <span class="string">"   t.j=   "</span>   +   t.j); <span class="comment">//1,2  </span></div><div class="line">  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>分析方法与上一段代码相同。</p>
<hr>
<p>本文参考自<a href="http://zwmf.iteye.com/blog/1738574" target="_blank" rel="external">zwmf</a>,本来想在这篇文章的基础上做一些修改，发现根本没有必要，博主写的很好，大部分都保留了，只做了一点修改，狗尾续貂。</p>
</div><div class="article-meta" style="max-width:600px"><div class="tags"><i class="icon icon-tag"></i><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/参数传递/">参数传递</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/对象/">对象</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/引用/">引用</a><span class="tag-list-count">1</span></li></ul></div><div class="categories"><i class="icon icon-category"></i><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">1</span></li></ul></div></div><div class="article-comment" style="max-width:600px"><div class="ds-thread" id="ds-thread" data-thread-key="cj0802ut40000mcvzafup5hdq" data-title="Java中的对象及其引用" data-url="http://yoursite.com/2017/03/05/Java中的对象及其引用/" site-name="ueibo"></div><script>var siteName = document.getElementById('ds-thread').getAttribute('site-name');
var duoshuoQuery = {short_name: siteName};
(function() {
  var ds = document.createElement('script');
  ds.type = 'text/javascript';ds.async = true;
  ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
  ds.charset = 'UTF-8';
  (document.getElementsByTagName('head')[0] 
  || document.getElementsByTagName('body')[0]).appendChild(ds);
})();</script></div><ul class="navication"><li class="home"><a href="/"><i class="icon icon-home"></i></a></li><li><a href="/2017/03/13/暂时停更/"><i class="icon icon-arror-left"></i></a></li><li><a href="/2017/03/04/时间片轮转法/"><i class="icon icon-arror-right"></i></a></li></ul><div class="page-footer"><div class="top"><ul class="social"><li><a href="https://github.com/WaldenLu" title="GitHub" target="_blank"><i class="icon icon-github"></i></a></li><li><a href="972672562@qq.com" title="Email" target="_blank"><i class="icon icon-email"></i></a></li></ul></div><div class="bottom"><p class="copyright">© 2017 Blog</p></div></div></body></html>